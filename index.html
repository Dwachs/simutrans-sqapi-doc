<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Simutrans-Squirrel-API: Main Page</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Simutrans-Squirrel-API
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Simutrans-Squirrel-API Documentation</div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#s_scenarios">Scripted scenarios</a><ul><li class="level2"><a href="#sec_howto">How to create a scenario.</a></li>
<li class="level2"><a href="#sec_ex">Example scenario scripts</a></li>
<li class="level2"><a href="#sec_dir">Recommended directory structure</a></li>
</ul>
</li>
<li class="level1"><a href="#s_ai_player">Scripted AI players</a></li>
<li class="level1"><a href="#s_scripted_tools">Scripted tools</a><ul><li class="level2"><a href="#sec_dir_tools">Recommended directory structure</a></li>
<li class="level2"><a href="#sec_description_tab">The file description.tab</a></li>
</ul>
</li>
<li class="level1"><a href="#s_general_advice">General scripting advice</a><ul><li class="level2"><a href="#sec_data_types">Squirrel data types</a></li>
<li class="level2"><a href="#sec_coord">Coordinates</a></li>
<li class="level2"><a href="#sec_network">Network play</a></li>
<li class="level2"><a href="#sec_err">Logging and error handling</a></li>
<li class="level2"><a href="#sec_rdwr">Load-Save support</a></li>
</ul>
</li>
</ul>
</div>
<div class="textblock"><p>Simutrans offers to possibility to add scripted scenarios and computer-controlled players.</p>
<h2>Scripting language </h2>
<p>The scripts have to be written in squirrel. The manual can be found at <a href="http://squirrel-lang.org/">Squirrel main page</a>. As squirrels like to crack nuts, understandably the script files get the extension '.nut'.</p>
<h1><a class="anchor" id="s_scenarios"></a>
Scripted scenarios</h1>
<p>See also <a class="el" href="group__scen__skel.html">Scenario interface</a> and <a class="el" href="group__scen__only.html">Scenario only functions</a>.</p>
<h2><a class="anchor" id="sec_howto"></a>
How to create a scenario.</h2>
<p>You first need an <em>idea</em> - a vision what a scenario may look like. Then you have to cast this idea into a <em>savegame</em>. That is, create the world in which your scenario will live. You are the ruler of this toy universe, you are in charge of the rules, which go into the <em>script</em>.</p>
<h2><a class="anchor" id="sec_ex"></a>
Example scenario scripts</h2>
<p>There are several commented examples.</p><ol type="1">
<li><a class="el" href="page_script_mill.html">A simple example script</a></li>
<li><a class="el" href="page_script_pharm.html">A script showing translatable texts.</a></li>
</ol>
<h2><a class="anchor" id="sec_dir"></a>
Recommended directory structure</h2>
<p>The scenario plays in a savegame. This savegame is tied to the pak-set you are using (e.g. pak64, pak128.Britain). Hence, the scenario files have to go into a sub-folder of the pak-set. The pak-set is found in a directory named pak-something, which is in the same directory, where the program itself is located.</p>
<p>Your scenario file goes into the folder</p>
<p><code> pak-something/scenario/myscenario/ </code></p>
<p>The scenario script must be in the file</p>
<p><code> pak-something/scenario/myscenario/scenario.nut </code></p>
<p>Translation files go into the scenario sub-directory with the same name as your file (just without extension)</p>
<p><code> pak-something/scenario/myscenario/ </code></p>
<p>If you need more complex texts, these go into sub-directories named after the language, in which they are written.</p>
<p><code> pak-something/scenario/myscenario/en/ &lt;- English files go here.</code></p>
<p><code>pak-something/scenario/myscenario/de/ &lt;- German files go here. </code></p>
<p>Scenarios can also be put into the addons folder:</p>
<p><code> addons/pak-something/scenario/myscenario/ </code></p>
<h1><a class="anchor" id="s_ai_player"></a>
Scripted AI players</h1>
<p>See also <a class="el" href="group__ai__skel.html">AI interface</a>.</p>
<h2><a class="anchor" id="sec_dir"></a>
Recommended directory structure</h2>
<p>Your script file goes into the folder</p>
<p><code> ai/myai/ </code></p>
<p>The main script file must be</p>
<p><code> ai/myai/ai.nut </code></p>
<p>The ai scripts can also be put into</p>
<p><code> addons/ai/myai/ </code></p>
<h1><a class="anchor" id="s_scripted_tools"></a>
Scripted tools</h1>
<p>See also <a class="el" href="group__tool__skel.html">Tool interface</a> and <a class="el" href="group__tool__only.html">Tool only functions</a>.</p>
<h2><a class="anchor" id="sec_dir_tools"></a>
Recommended directory structure</h2>
<p>The script file (tool.nut) as well as the configuration file (description.tab) go into</p>
<p><code> pak-something/tool/mytool/ </code></p>
<p>Related pak-files have to be placed in</p>
<p><code> pak-something/ </code></p>
<p>directly.</p>
<h2><a class="anchor" id="sec_description_tab"></a>
The file description.tab</h2>
<p>This is a plain text file with the following entries:<br />
 <code> title=Name of tool to be shown in tool selection dialog <br />
 type=one_click or two_click<br />
 tooltip=Tooltip for the icon in the toolbar<br />
 restart=Set to 1 if the virtual machine has to be restarted after each call to the work functions.<br />
 menu=Parameter that can be used to load tools with menuconf.tab<br />
 icon=Name of cursor object (loaded from some pak-file), used images: 0 = cursor, 1 = icon, 2 = marker image<br />
 </code></p>
<h1><a class="anchor" id="s_general_advice"></a>
General scripting advice</h1>
<p>Check out the sections on the <a href="modules.html">Modules</a> page. See also <a class="el" href="pitfalls.html">Common pitfalls</a>.</p>
<h2><a class="anchor" id="sec_data_types"></a>
Squirrel data types</h2>
<p>Squirrel has some built-in data types: among them integer, string, tables, and arrays. These are widely used throughout this documentation in the function declarations.</p>
<p>If tables or arrays carry template parameters, this indicates the expected type of elements of the array or table. See <a class="el" href="classfactory__x.html#a12ef2a42dc706f5d519f570de1b5d2d7">factory_x::input</a> for an example.</p>
<h2><a class="anchor" id="sec_coord"></a>
Coordinates</h2>
<p>All coordinates in the script are with respect to the initial rotation of the map. If a player rotates a map, then all coordinates are translated to the original rotation. This affects the classes <a class="el" href="classcoord.html">coord</a> and <a class="el" href="classcoord3d.html">coord3d</a> as well as any functions that expect coordinates as input, as for instance <a class="el" href="classfactory__x.html#a98b2f0806cb15884d5b3d773253877a1">factory_x::factory_x</a> or <a class="el" href="classrules.html#abf8f8c6b1c0064f648e5e0fff83cecf4">rules::forbid_way_tool_rect</a>.</p>
<h2><a class="anchor" id="sec_network"></a>
Network play</h2>
<p>A lot of stuff is possible for network play. There are some limitations of course. These are due to the fact, that the scripts are solely run on the server, the client does not need to have the script available at all. This implies for instance that all scenario texts are translated to the server's language.</p>
<h2><a class="anchor" id="sec_err"></a>
Logging and error handling</h2>
<p>If simutrans is started with '-debug 2', all errors and warnings are logged to standard output (i.e. terminal). If simutrans is started in addition with '-log', all the output is written to the file script.log. In particular, everything that is print-ed by the script, goes into this file.</p>
<p>In case of error, an error window pops up showing the call stack and the values of local variables. You can then repair your script, and restart the scenario via New Game - Scenario. You do not need to restart simutrans to reload your script.</p>
<h2><a class="anchor" id="sec_rdwr"></a>
Load-Save support</h2>
<p>Such support is available of course. If a running scenario is saved, the information about the scenario is saved within the savegame. Upon loading, the scenario is resumed, by calling the function <a class="el" href="group__ai__skel.html#ga7e82c4a303ffc379d846b26ef07b9c81">resume_game</a>.</p>
<p>You can save data in the savegame. In order to do so, you have to keep these data in the global table <a class="el" href="api__skeleton_8h.html#a48c699ff842c97fffb74ab077b6d4882" title="Persistent data should go into this table. ">persistent</a>. This table is saved and loaded. </p>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.14
</small></address>
</body>
</html>
