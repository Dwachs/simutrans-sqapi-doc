<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>Simutrans-Squirrel-API: Main Page</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />

<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>

</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">Simutrans-Squirrel-API
   
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.5.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li class="current"><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="headertitle">
<div class="title">Simutrans-Squirrel-API Documentation</div>  </div>
</div>
<div class="contents">
<div class="textblock"><h2><a class="anchor" id="sec_howto"></a>
How to create a scenario.</h2>
<p>You first need a <em>idea</em> - a vision what a scenario may look like. Then you have to cast these idea into a <em>savegame</em>. That is, create the world in which your scenario will live. You are the ruler of this toy universe, you are in charge of the rules, which go into the <em>script</em>.</p>
<h2><a class="anchor" id="sec_sq"></a>
Scripting language</h2>
<p>The scripts have to be written in squirrel. The manual can be found at <a href="http://squirrel-lang.org/">Squirrel main page</a>. As squirrels like to crack nuts, understandably the script files get the extension '.nut'.</p>
<h2><a class="anchor" id="sec_ex"></a>
Example script</h2>
<p>There are several commented examples.</p>
<ol type="1">
<li><a class="el" href="page_script_mill.html">A simple example script</a></li>
<li><a class="el" href="page_script_pharm.html">A script showing translatable texts.</a></li>
</ol>
<h2><a class="anchor" id="sec_data_types"></a>
Squirrel data types</h2>
<p>Squirrel has some built-in data types: among them integer, string, tables, and arrays. These are widely used throughout this documentation in the function declarations.</p>
<p>If tables or arrays carry template parameters, this indicates the expected type of elements of the array or table. See <a class="el" href="classfactory__x.html#a12ef2a42dc706f5d519f570de1b5d2d7">factory_x::input</a> for an example.</p>
<h2><a class="anchor" id="sec_coord"></a>
Coordinates</h2>
<p>All coordinates in the script are with respect to the initial rotation of the map. If a player rotates a map, then all coordinates are translated to the original rotation. This effects the classes <a class="el" href="classcoord.html">coord</a> and <a class="el" href="classcoord3d.html">coord3d</a> as well as any functions that expect coordinates as input, as for instance <a class="el" href="classfactory__x.html#a98b2f0806cb15884d5b3d773253877a1">factory_x::factory_x</a> or <a class="el" href="classrules.html#abf8f8c6b1c0064f648e5e0fff83cecf4">rules::forbid_way_tool_rect</a>.</p>
<h2><a class="anchor" id="sec_network"></a>
Network play</h2>
<p>A lot of stuff is possible for network play. There are some limitations of course. These are due to the fact, that the script is solely run on the server, the client does not need to have the script available at all. This implies for instance that all scenario texts are translated to the server's language.</p>
<h2><a class="anchor" id="sec_err"></a>
Logging and error handling</h2>
<p>If simutrans is started with '-debug 2', all errors and warnings are logged to standard output (i.e. terminal). If simutrans is started in addition with '-log 1', all the output is written to the file script.log. In particular, everything that is print-ed by the script, goes into this file.</p>
<p>In case of error, an error window pops up showing the call stack and the values of local variables. You can then repair your script, and the restart the scenario via New Game - Scenario. You do not need to restart simutrans to reload your script.</p>
<h2><a class="anchor" id="sec_rdwr"></a>
Load-Save support</h2>
<p>Such support is available of course. If a running scenario is saved, the information about the scenario is saved within the savegame. Upon loading, the scenario is resumed, by calling the function <a class="el" href="api__skeleton_8cc.html#a8f7187d43d6ca08f59ce949f9c4938f8">resume_game</a>.</p>
<p>You can save data in the savegame. In order to do so, you have to keep these data in the global structure <a class="el" href="api__skeleton_8h.html#a48c699ff842c97fffb74ab077b6d4882" title="Persistent data should go into this table.">persistent</a>. This data is saved and loaded.</p>
<h2><a class="anchor" id="sec_dir"></a>
Recommended directory structure</h2>
<p>The scenario plays in a savegame. This savegame is tied to the pak-set you are using (e.g. pak64, pak128.Britain). Hence, the scenario files have to go into a sub-folder of the pak-set. The pak-set is found in a directory named pak-something, which is in the same directory, where the program itself is located.</p>
<p>Your scenario file goes into the folder</p>
<p><code> pak-something/scenario/myscenario/ </code></p>
<p>The scenario script must be in the file</p>
<p><code> pak-something/scenario/myscenario/scenario.nut </code></p>
<p>Translation files go into the scenario sub-directory with the same name as your file (just without extension)</p>
<p><code> pak-something/scenario/myscenario/ </code></p>
<p>If need more complex texts, these go into sub-directories named after the language, in which they are written.</p>
<p><code> pak-something/scenario/myscenario/en/ &lt;- English files go here.</code></p>
<p><code> pak-something/scenario/myscenario/de/ &lt;- German files go here. </code> </p>
</div></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerator</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>



<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.7.5.1
</small></address>

</body>
</html>
